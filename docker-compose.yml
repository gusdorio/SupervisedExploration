services:
  # Machine Learning Model Service
  ml-model:
    build:
      context: .
      dockerfile: ml_model/Dockerfile.ml
    container_name: ml-model-service
    volumes:
      - ./data:/app/data  # Access to data (read/write for processing)
      - ./ml_model/classes:/app/classes:ro  # Read-only access to classes
      - ./models:/app/models:ro  # Access to database models
      - ./data/results:/app/data/results  # Results output directory
    networks:
      - app-network
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      # Database configuration (when using containers)
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_DATABASE=icb_db
      - MYSQL_USER=icb_user
      - MYSQL_PASSWORD=icb_password123
      - MONGO_HOST=mongodb
      - MONGO_PORT=27017
      - MONGO_DATABASE=icb_ml
      - MONGO_USER=root
      - MONGO_PASSWORD=root_password123
    # Note: To use with databases, uncomment the following:
    # depends_on:
    #   - mysql
    #   - mongodb

  # Streamlit Dashboard Service
  streamlit-dashboard:
    build:
      context: .
      dockerfile: streamlit/Dockerfile.streamlit
    container_name: streamlit-dashboard
    ports:
      - "8501:8501"  # Expose Streamlit dashboard to host
    volumes:
      - ./data:/app/data:ro  # Read-only access to data
      - ./ml_model/classes:/app/classes:ro  # Read-only access to classes
      - ./models:/app/models:ro  # Access to database models
      - ./streamlit/dashboard.py:/app/dashboard.py:ro  # Mount dashboard for hot-reload during development
    networks:
      - app-network
    depends_on:
      - ml-model
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      # Database configuration (when using containers)
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_DATABASE=icb_db
      - MYSQL_USER=icb_user
      - MYSQL_PASSWORD=icb_password123
      - MONGO_HOST=mongodb
      - MONGO_PORT=27017
      - MONGO_DATABASE=icb_ml
      - MONGO_USER=root
      - MONGO_PASSWORD=root_password123
    # Note: To use with databases, uncomment the following:
    # depends_on:
    #   - ml-model
    #   - mysql
    #   - mongodb

networks:
  app-network:
    driver: bridge

# Note: Database services are defined in docker-compose.db.yml
# To run the full stack with databases:
# docker-compose -f docker-compose.db.yml -f docker-compose.yml up
