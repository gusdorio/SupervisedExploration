version: '3.8'

services:
  # Machine Learning Model Service
  ml-model:
    build:
      context: .
      dockerfile: ml_model/Dockerfile.ml
    container_name: ml-model-service
    volumes:
      - ./data:/app/data  # Access to data (read/write for processing)
      - ./ml_model/classes:/app/classes:ro  # Read-only access to classes
      - ./data/results:/app/data/results  # Results output directory
    networks:
      - app-network
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1

  # Streamlit Dashboard Service
  streamlit-dashboard:
    build:
      context: .
      dockerfile: streamlit/Dockerfile.streamlit
    container_name: streamlit-dashboard
    ports:
      - "8501:8501"  # Expose Streamlit dashboard to host
    volumes:
      - ./data:/app/data:ro  # Read-only access to data
      - ./ml_model/classes:/app/classes:ro  # Read-only access to classes
      - ./dashboard.py:/app/dashboard.py:ro  # Mount dashboard for hot-reload during development
    networks:
      - app-network
    depends_on:
      - ml-model
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1

networks:
  app-network:
    driver: bridge
